"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RawBuffer = void 0;
const ByteBuffer = require("bytebuffer");
class RawBuffer {
    constructor(b) {
        /** @deprecated use readInt32() instead */
        this.readInt = this.readInt32;
        /** @deprecated use writeInt32() instead */
        this.writeInt = this.writeInt32;
        /** @deprecated use readInt64() instead */
        this.readLong = this.readInt64;
        /** @deprecated use writeInt64() instead */
        this.writeLong = this.writeInt64;
        /** @deprecated use readFloat32() instead */
        this.readFloat = this.readFloat32;
        /** @deprecated use writeFloat32() instead */
        this.writeFloat = this.writeFloat32;
        /** @deprecated use readFloat64() instead */
        this.readDouble = this.readFloat64;
        /** @deprecated use writeFloat64() instead */
        this.writeDouble = this.writeFloat64;
        if (typeof b === 'number') {
            this.buffer = ByteBuffer.allocate(b).LE(true);
        }
        else {
            this.buffer = ByteBuffer.wrap(b).LE(true);
        }
    }
    clear() {
        this.buffer.clear();
    }
    setOffset(offset) {
        this.buffer.offset = offset;
    }
    getOffset() {
        return this.buffer.offset;
    }
    getBuffer() {
        this.buffer.flip();
        return this.buffer.toBuffer(true);
    }
    write(bytes) {
        this.buffer.append(bytes);
    }
    writeByte(byte) {
        this.buffer.writeByte(byte);
    }
    readBytes(length) {
        const bytes = this.buffer.readBytes(length).copy();
        return bytes.toBuffer();
    }
    readInt16() {
        return this.buffer.readInt16();
    }
    readInt32() {
        return this.buffer.readInt32();
    }
    readUint32() {
        return this.buffer.readUint32();
    }
    writeInt16(value, offset) {
        this.buffer.writeInt16(value, offset);
    }
    writeInt32(value, offset) {
        this.buffer.writeInt32(value, offset);
    }
    readInt64() {
        return this.buffer.readInt64().toNumber();
    }
    readUint64() {
        return this.buffer.readUint64();
    }
    writeInt64(value) {
        this.buffer.writeInt64(value);
    }
    writeUint32(value, offset) {
        this.buffer.writeUint64(value, offset);
    }
    writeUint64(value, offset) {
        this.buffer.writeUint64(value, offset);
    }
    readFloat32() {
        return this.buffer.readFloat32();
    }
    writeFloat32(value) {
        this.buffer.writeFloat32(value);
    }
    readFloat64() {
        return this.buffer.readFloat64();
    }
    writeFloat64(value) {
        this.buffer.writeFloat64(value);
    }
    writeString(value, fixedLength) {
        putString(this.buffer, value, fixedLength || value.length);
    }
    readString8() {
        return makeString(this.buffer, 8);
    }
    writeString8(value) {
        putString(this.buffer, value, 8);
    }
    writeString30(value) {
        putString(this.buffer, value, 30);
    }
    readString32() {
        return makeString(this.buffer, 32);
    }
    writeString32(value) {
        putString(this.buffer, value, 32);
    }
    readString64() {
        return makeString(this.buffer, 64);
    }
    writeString64(value) {
        putString(this.buffer, value, 64);
    }
    readString128() {
        return makeString(this.buffer, 128);
    }
    writeString128(value) {
        putString(this.buffer, value, 128);
    }
    readString256() {
        return makeString(this.buffer, 256);
    }
    writeString256(value) {
        putString(this.buffer, value, 256);
    }
    readString260() {
        return makeString(this.buffer, 260);
    }
    writeString260(value) {
        putString(this.buffer, value, 260);
    }
    readStringV() {
        let bytesRead = 0;
        let strLen = 0;
        let endFound = false;
        while (this.buffer.offset < this.buffer.limit) {
            const currentByte = this.buffer.readByte();
            bytesRead++;
            if (endFound && currentByte !== 0) {
                break; // Reached beginning of new value
            }
            else if (currentByte === 0) {
                endFound = true;
            }
            strLen++;
        }
        // Reset offset so we can read the same bytes later
        this.buffer.offset -= bytesRead;
        return makeString(this.buffer, strLen);
    }
    readString(length) {
        return makeString(this.buffer, length);
    }
    remaining() {
        return this.buffer.remaining();
    }
}
exports.RawBuffer = RawBuffer;
function makeString(bf, expectedLength) {
    const content = bf.readCString(bf.offset);
    bf.skip(expectedLength);
    return content.string;
}
function putString(bf, s, fixed) {
    const value = s === null ? '' : s;
    const bytes = Buffer.from(value, 'utf-8');
    bf.append(bytes);
    if (bytes.length < fixed) {
        for (let i = 0; i < fixed - bytes.length; i++) {
            bf.writeByte(0x00);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmF3QnVmZmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1Jhd0J1ZmZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx5Q0FBMEM7QUFFMUMsTUFBTSxTQUFTO0lBR1gsWUFBWSxDQUFrQjtRQXNEOUIsMENBQTBDO1FBQzFDLFlBQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBTXpCLDJDQUEyQztRQUMzQyxhQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQVUzQiwwQ0FBMEM7UUFDMUMsYUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFjMUIsMkNBQTJDO1FBQzNDLGNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBTTVCLDRDQUE0QztRQUM1QyxjQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQU03Qiw2Q0FBNkM7UUFDN0MsZUFBVSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFNL0IsNENBQTRDO1FBQzVDLGVBQVUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBTTlCLDZDQUE2QztRQUM3QyxnQkFBVyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFuSDVCLElBQUksT0FBTyxDQUFDLEtBQUssUUFBUSxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDakQ7YUFBTTtZQUNILElBQUksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDN0M7SUFDTCxDQUFDO0lBRUQsS0FBSztRQUNELElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVELFNBQVMsQ0FBQyxNQUFjO1FBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFH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Q0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFhO1FBQ3RCLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQWE7UUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxZQUFZO1FBQ1IsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQWE7UUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxZQUFZO1FBQ1IsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQWE7UUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxhQUFhO1FBQ1QsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsY0FBYyxDQUFDLEtBQWE7UUFDeEIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxhQUFhO1FBQ1QsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsY0FBYyxDQUFDLEtBQW9CO1FBQy9CLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsYUFBYTtRQUNULE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVELGNBQWMsQ0FBQyxLQUFhO1FBQ3hCLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsV0FBVztRQUNQLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztRQUNsQixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFDZixJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7UUFDckIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRTtZQUMzQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzNDLFNBQVMsRUFBRSxDQUFDO1lBQ1osSUFBSSxRQUFRLElBQUksV0FBVyxLQUFLLENBQUMsRUFBRTtnQkFDL0IsTUFBTSxDQUFDLGlDQUFpQzthQUMzQztpQkFBTSxJQUFJLFdBQVcsS0FBSyxDQUFDLEVBQUU7Z0JBQzFCLFFBQVEsR0FBRyxJQUFJLENBQUM7YUFDbkI7WUFDRCxNQUFNLEVBQUUsQ0FBQztTQUNaO1FBQ0QsbURBQW1EO1FBQ25ELElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQztRQUNoQyxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxVQUFVLENBQUMsTUFBYztRQUNyQixPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxTQUFTO1FBQ0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25DLENBQUM7Q0FDSjtBQW1CUSw4QkFBUztBQWpCbEIsU0FBUyxVQUFVLENBQUMsRUFBYyxFQUFFLGNBQXNCO0lBQ3RELE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDeEIsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzFCLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxFQUFjLEVBQUUsQ0FBZ0IsRUFBRSxLQUFhO0lBQzlELE1BQU0sS0FBSyxHQUFHLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xDLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakIsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssRUFBRTtRQUN0QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDM0MsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN0QjtLQUNKO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCeXRlQnVmZmVyID0gcmVxdWlyZSgnYnl0ZWJ1ZmZlcicpO1xyXG5cclxuY2xhc3MgUmF3QnVmZmVyIHtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgYnVmZmVyOiBCeXRlQnVmZmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGI6IEJ1ZmZlciB8IG51bWJlcikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgYiA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgdGhpcy5idWZmZXIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKGIpLkxFKHRydWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyID0gQnl0ZUJ1ZmZlci53cmFwKGIpLkxFKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLmJ1ZmZlci5jbGVhcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldE9mZnNldChvZmZzZXQ6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuYnVmZmVyLm9mZnNldCA9IG9mZnNldDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRPZmZzZXQoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIub2Zmc2V0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldEJ1ZmZlcigpOiBCdWZmZXIge1xyXG4gICAgICAgIHRoaXMuYnVmZmVyLmZsaXAoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIudG9CdWZmZXIodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGUoYnl0ZXM6IEJ1ZmZlcikge1xyXG4gICAgICAgIHRoaXMuYnVmZmVyLmFwcGVuZChieXRlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVCeXRlKGJ5dGU6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuYnVmZmVyLndyaXRlQnl0ZShieXRlKTtcclxuICAgIH1cclxuXHJcbiAgICByZWFkQnl0ZXMobGVuZ3RoOiBudW1iZXIpOiBCdWZmZXIge1xyXG4gICAgICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5idWZmZXIucmVhZEJ5dGVzKGxlbmd0aCkuY29weSgpO1xyXG4gICAgICAgIHJldHVybiBieXRlcy50b0J1ZmZlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRJbnQxNigpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5yZWFkSW50MTYoKTtcclxuICAgIH1cclxuXHJcbiAgICByZWFkSW50MzIoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZEludDMyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVhZFVpbnQzMigpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5yZWFkVWludDMyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVJbnQxNih2YWx1ZTogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLmJ1ZmZlci53cml0ZUludDE2KHZhbHVlLCBvZmZzZXQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiBAZGVwcmVjYXRlZCB1c2UgcmVhZEludDMyKCkgaW5zdGVhZCAqL1xyXG4gICAgcmVhZEludCA9IHRoaXMucmVhZEludDMyO1xyXG5cclxuICAgIHdyaXRlSW50MzIodmFsdWU6IG51bWJlciwgb2Zmc2V0PzogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVJbnQzMih2YWx1ZSwgb2Zmc2V0KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHdyaXRlSW50MzIoKSBpbnN0ZWFkICovXHJcbiAgICB3cml0ZUludCA9IHRoaXMud3JpdGVJbnQzMjtcclxuXHJcbiAgICByZWFkSW50NjQoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZEludDY0KCkudG9OdW1iZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICByZWFkVWludDY0KCk6IExvbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5yZWFkVWludDY0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSByZWFkSW50NjQoKSBpbnN0ZWFkICovXHJcbiAgICByZWFkTG9uZyA9IHRoaXMucmVhZEludDY0O1xyXG5cclxuICAgIHdyaXRlSW50NjQodmFsdWU6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuYnVmZmVyLndyaXRlSW50NjQodmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVWludDMyKHZhbHVlOiBudW1iZXIsIG9mZnNldD86IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuYnVmZmVyLndyaXRlVWludDY0KHZhbHVlLCBvZmZzZXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlVWludDY0KHZhbHVlOiBMb25nLCBvZmZzZXQ/OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLmJ1ZmZlci53cml0ZVVpbnQ2NCh2YWx1ZSwgb2Zmc2V0KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHdyaXRlSW50NjQoKSBpbnN0ZWFkICovXHJcbiAgICB3cml0ZUxvbmcgPSB0aGlzLndyaXRlSW50NjQ7XHJcblxyXG4gICAgcmVhZEZsb2F0MzIoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZEZsb2F0MzIoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHJlYWRGbG9hdDMyKCkgaW5zdGVhZCAqL1xyXG4gICAgcmVhZEZsb2F0ID0gdGhpcy5yZWFkRmxvYXQzMjtcclxuXHJcbiAgICB3cml0ZUZsb2F0MzIodmFsdWU6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuYnVmZmVyLndyaXRlRmxvYXQzMih2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSB3cml0ZUZsb2F0MzIoKSBpbnN0ZWFkICovXHJcbiAgICB3cml0ZUZsb2F0ID0gdGhpcy53cml0ZUZsb2F0MzI7XHJcblxyXG4gICAgcmVhZEZsb2F0NjQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlYWRGbG9hdDY0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSByZWFkRmxvYXQ2NCgpIGluc3RlYWQgKi9cclxuICAgIHJlYWREb3VibGUgPSB0aGlzLnJlYWRGbG9hdDY0O1xyXG5cclxuICAgIHdyaXRlRmxvYXQ2NCh2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVGbG9hdDY0KHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHdyaXRlRmxvYXQ2NCgpIGluc3RlYWQgKi9cclxuICAgIHdyaXRlRG91YmxlID0gdGhpcy53cml0ZUZsb2F0NjQ7XHJcblxyXG4gICAgd3JpdGVTdHJpbmcodmFsdWU6IHN0cmluZywgZml4ZWRMZW5ndGg/OiBudW1iZXIpIHtcclxuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCBmaXhlZExlbmd0aCB8fCB2YWx1ZS5sZW5ndGgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRTdHJpbmc4KCkge1xyXG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCA4KTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVN0cmluZzgodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHB1dFN0cmluZyh0aGlzLmJ1ZmZlciwgdmFsdWUsIDgpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlU3RyaW5nMzAodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHB1dFN0cmluZyh0aGlzLmJ1ZmZlciwgdmFsdWUsIDMwKTtcclxuICAgIH1cclxuXHJcbiAgICByZWFkU3RyaW5nMzIoKSB7XHJcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDMyKTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVN0cmluZzMyKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCAzMik7XHJcbiAgICB9XHJcblxyXG4gICAgcmVhZFN0cmluZzY0KCkge1xyXG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCA2NCk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVTdHJpbmc2NCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgNjQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRTdHJpbmcxMjgoKSB7XHJcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDEyOCk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVTdHJpbmcxMjgodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIHB1dFN0cmluZyh0aGlzLmJ1ZmZlciwgdmFsdWUsIDEyOCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVhZFN0cmluZzI1NigpIHtcclxuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgMjU2KTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVN0cmluZzI1Nih2YWx1ZTogc3RyaW5nIHwgbnVsbCkge1xyXG4gICAgICAgIHB1dFN0cmluZyh0aGlzLmJ1ZmZlciwgdmFsdWUsIDI1Nik7XHJcbiAgICB9XHJcblxyXG4gICAgcmVhZFN0cmluZzI2MCgpIHtcclxuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgMjYwKTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVN0cmluZzI2MCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMjYwKTtcclxuICAgIH1cclxuXHJcbiAgICByZWFkU3RyaW5nVigpIHtcclxuICAgICAgICBsZXQgYnl0ZXNSZWFkID0gMDtcclxuICAgICAgICBsZXQgc3RyTGVuID0gMDtcclxuICAgICAgICBsZXQgZW5kRm91bmQgPSBmYWxzZTtcclxuICAgICAgICB3aGlsZSAodGhpcy5idWZmZXIub2Zmc2V0IDwgdGhpcy5idWZmZXIubGltaXQpIHtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudEJ5dGUgPSB0aGlzLmJ1ZmZlci5yZWFkQnl0ZSgpO1xyXG4gICAgICAgICAgICBieXRlc1JlYWQrKztcclxuICAgICAgICAgICAgaWYgKGVuZEZvdW5kICYmIGN1cnJlbnRCeXRlICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhazsgLy8gUmVhY2hlZCBiZWdpbm5pbmcgb2YgbmV3IHZhbHVlXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudEJ5dGUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGVuZEZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzdHJMZW4rKztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUmVzZXQgb2Zmc2V0IHNvIHdlIGNhbiByZWFkIHRoZSBzYW1lIGJ5dGVzIGxhdGVyXHJcbiAgICAgICAgdGhpcy5idWZmZXIub2Zmc2V0IC09IGJ5dGVzUmVhZDtcclxuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgc3RyTGVuKTtcclxuICAgIH1cclxuXHJcbiAgICByZWFkU3RyaW5nKGxlbmd0aDogbnVtYmVyKSB7XHJcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIGxlbmd0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtYWluaW5nKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5yZW1haW5pbmcoKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gbWFrZVN0cmluZyhiZjogQnl0ZUJ1ZmZlciwgZXhwZWN0ZWRMZW5ndGg6IG51bWJlcikge1xyXG4gICAgY29uc3QgY29udGVudCA9IGJmLnJlYWRDU3RyaW5nKGJmLm9mZnNldCk7XHJcbiAgICBiZi5za2lwKGV4cGVjdGVkTGVuZ3RoKTtcclxuICAgIHJldHVybiBjb250ZW50LnN0cmluZztcclxufVxyXG5cclxuZnVuY3Rpb24gcHV0U3RyaW5nKGJmOiBCeXRlQnVmZmVyLCBzOiBzdHJpbmcgfCBudWxsLCBmaXhlZDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCB2YWx1ZSA9IHMgPT09IG51bGwgPyAnJyA6IHM7XHJcbiAgICBjb25zdCBieXRlcyA9IEJ1ZmZlci5mcm9tKHZhbHVlLCAndXRmLTgnKTtcclxuICAgIGJmLmFwcGVuZChieXRlcyk7XHJcbiAgICBpZiAoYnl0ZXMubGVuZ3RoIDwgZml4ZWQpIHtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpeGVkIC0gYnl0ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgYmYud3JpdGVCeXRlKDB4MDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgUmF3QnVmZmVyIH07XHJcbiJdfQ==