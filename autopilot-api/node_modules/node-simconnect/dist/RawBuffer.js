"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RawBuffer = void 0;
const ByteBuffer = require("bytebuffer");
class RawBuffer {
    constructor(b) {
        /** @deprecated use readInt32() instead */
        this.readInt = this.readInt32;
        /** @deprecated use writeInt32() instead */
        this.writeInt = this.writeInt32;
        /** @deprecated use readInt64() instead */
        this.readLong = this.readInt64;
        /** @deprecated use writeInt64() instead */
        this.writeLong = this.writeInt64;
        /** @deprecated use readFloat32() instead */
        this.readFloat = this.readFloat32;
        /** @deprecated use writeFloat32() instead */
        this.writeFloat = this.writeFloat32;
        /** @deprecated use readFloat64() instead */
        this.readDouble = this.readFloat64;
        /** @deprecated use writeFloat64() instead */
        this.writeDouble = this.writeFloat64;
        if (typeof b === 'number') {
            this.buffer = ByteBuffer.allocate(b).LE(true);
        }
        else {
            this.buffer = ByteBuffer.wrap(b).LE(true);
        }
    }
    clear() {
        this.buffer.clear();
    }
    setOffset(offset) {
        this.buffer.offset = offset;
    }
    getOffset() {
        return this.buffer.offset;
    }
    getBuffer() {
        this.buffer.flip();
        return this.buffer.toBuffer(true);
    }
    write(bytes) {
        this.buffer.append(bytes);
    }
    writeByte(byte) {
        this.buffer.writeByte(byte);
    }
    readBytes(length) {
        const bytes = this.buffer.readBytes(length).copy();
        return bytes.toBuffer();
    }
    readInt16() {
        return this.buffer.readInt16();
    }
    readInt32() {
        return this.buffer.readInt32();
    }
    readUint32() {
        return this.buffer.readUint32();
    }
    writeInt16(value, offset) {
        this.buffer.writeInt16(value, offset);
    }
    writeInt32(value, offset) {
        this.buffer.writeInt32(value, offset);
    }
    readInt64() {
        return this.buffer.readInt64().toNumber();
    }
    readUint64() {
        return BigInt(this.buffer.readUint64().toString(10));
    }
    writeInt64(value) {
        this.buffer.writeInt64(value);
    }
    writeUint32(value, offset) {
        this.buffer.writeUint64(value, offset);
    }
    writeUint64(value, offset) {
        const buffer = Buffer.alloc(8);
        buffer.writeBigUint64LE(value);
        this.buffer.append(buffer, undefined, offset);
    }
    readFloat32() {
        return this.buffer.readFloat32();
    }
    writeFloat32(value) {
        this.buffer.writeFloat32(value);
    }
    readFloat64() {
        return this.buffer.readFloat64();
    }
    writeFloat64(value) {
        this.buffer.writeFloat64(value);
    }
    writeString(value, fixedLength) {
        putString(this.buffer, value, fixedLength || value.length);
    }
    readString8() {
        return makeString(this.buffer, 8);
    }
    writeString8(value) {
        putString(this.buffer, value, 8);
    }
    writeString30(value) {
        putString(this.buffer, value, 30);
    }
    readString32() {
        return makeString(this.buffer, 32);
    }
    writeString32(value) {
        putString(this.buffer, value, 32);
    }
    readString64() {
        return makeString(this.buffer, 64);
    }
    writeString64(value) {
        putString(this.buffer, value, 64);
    }
    readString128() {
        return makeString(this.buffer, 128);
    }
    writeString128(value) {
        putString(this.buffer, value, 128);
    }
    readString256() {
        return makeString(this.buffer, 256);
    }
    writeString256(value) {
        putString(this.buffer, value, 256);
    }
    readString260() {
        return makeString(this.buffer, 260);
    }
    writeString260(value) {
        putString(this.buffer, value, 260);
    }
    readStringV() {
        let bytesRead = 0;
        let strLen = 0;
        let endFound = false;
        while (this.buffer.offset < this.buffer.limit) {
            const currentByte = this.buffer.readByte();
            bytesRead++;
            if (endFound && currentByte !== 0) {
                break; // Reached beginning of new value
            }
            else if (currentByte === 0) {
                endFound = true;
            }
            strLen++;
        }
        // Reset offset so we can read the same bytes later
        this.buffer.offset -= bytesRead;
        return makeString(this.buffer, strLen);
    }
    readString(length) {
        return makeString(this.buffer, length);
    }
    remaining() {
        return this.buffer.remaining();
    }
}
exports.RawBuffer = RawBuffer;
function makeString(bf, expectedLength) {
    const content = bf.readCString(bf.offset);
    bf.skip(expectedLength);
    return content.string;
}
function putString(bf, s, fixed) {
    const value = s === null ? '' : s;
    const bytes = Buffer.from(value, 'utf-8');
    bf.append(bytes);
    if (bytes.length < fixed) {
        for (let i = 0; i < fixed - bytes.length; i++) {
            bf.writeByte(0x00);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmF3QnVmZmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1Jhd0J1ZmZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx5Q0FBMEM7QUFFMUMsTUFBTSxTQUFTO0lBR1gsWUFBWSxDQUFrQjtRQXNEOUIsMENBQTBDO1FBQzFDLFlBQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBTXpCLDJDQUEyQztRQUMzQyxhQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQVUzQiwwQ0FBMEM7UUFDMUMsYUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFnQjFCLDJDQUEyQztRQUMzQyxjQUFTLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQU01Qiw0Q0FBNEM7UUFDNUMsY0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFNN0IsNkNBQTZDO1FBQzdDLGVBQVUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBTS9CLDRDQUE0QztRQUM1QyxlQUFVLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQU05Qiw2Q0FBNkM7UUFDN0MsZ0JBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBckg1QixJQUFJLE9BQU8sQ0FBQyxLQUFLLFFBQVEsRUFBRTtZQUN2QixJQUFJLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2pEO2FBQU07WUFDSCxJQUFJLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzdDO0lBQ0wsQ0FBQztJQUVELEtBQUs7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxTQUFTLENBQUMsTUFBYztRQUNwQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDaEMsQ0FBQztJQUVELFNBQVM7UUFDTCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQzlCLENBQUM7SUFFRCxTQUFTO1FBQ0wsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNuQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxLQUFLLENBQUMsS0FBYTtRQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCxTQUFTLENBQUMsSUFBWTtRQUNsQixJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsU0FBUyxDQUFDLE1BQWM7UUFDcEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDbkQsT0FBTyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVELFNBQVM7UUFDTCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVELFNBQVM7UUFDTCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVELFVBQVU7UUFDTixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDcEMsQ0FBQztJQUVELFVBQVUsQ0FBQyxLQUFhLEVBQUUsTUFBZTtRQUNyQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUtELFVBQVUsQ0FBQyxLQUFhLEVBQUUsTUFBZTtRQUNyQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUtELFNBQVM7UUFDTCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDOUMsQ0FBQztJQUVELFVBQVU7UUFDTixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFLRCxVQUFVLENBQUMsS0FBYTtRQUNwQixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQWEsRUFBRSxNQUFlO1FBQ3RDLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQWEsRUFBRSxNQUFlO1FBQ3RDLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0IsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUtELFdBQVc7UUFDUCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckMsQ0FBQztJQUtELFlBQVksQ0FBQyxLQUFhO1FBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFLRCxXQUFXO1FBQ1AsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFLRCxZQUFZLENBQUMsS0FBYTtRQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBS0QsV0FBVyxDQUFDLEtBQWEsRUFBRSxXQUFvQjtRQUMzQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsV0FBVyxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRUQsV0FBVztRQUNQLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFhO1FBQ3RCLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQWE7UUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxZQUFZO1FBQ1IsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQWE7UUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxZQUFZO1FBQ1IsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQWE7UUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxhQUFhO1FBQ1QsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsY0FBYyxDQUFDLEtBQWE7UUFDeEIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxhQUFhO1FBQ1QsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsY0FBYyxDQUFDLEtBQW9CO1FBQy9CLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsYUFBYTtRQUNULE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVELGNBQWMsQ0FBQyxLQUFhO1FBQ3hCLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsV0FBVztRQUNQLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztRQUNsQixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFDZixJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7UUFDckIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRTtZQUMzQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzNDLFNBQVMsRUFBRSxDQUFDO1lBQ1osSUFBSSxRQUFRLElBQUksV0FBVyxLQUFLLENBQUMsRUFBRTtnQkFDL0IsTUFBTSxDQUFDLGlDQUFpQzthQUMzQztpQkFBTSxJQUFJLFdBQVcsS0FBSyxDQUFDLEVBQUU7Z0JBQzFCLFFBQVEsR0FBRyxJQUFJLENBQUM7YUFDbkI7WUFDRCxNQUFNLEVBQUUsQ0FBQztTQUNaO1FBQ0QsbURBQW1EO1FBQ25ELElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQztRQUNoQyxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxVQUFVLENBQUMsTUFBYztRQUNyQixPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxTQUFTO1FBQ0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25DLENBQUM7Q0FDSjtBQW1CUSw4QkFBUztBQWpCbEIsU0FBUyxVQUFVLENBQUMsRUFBYyxFQUFFLGNBQXNCO0lBQ3RELE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDeEIsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzFCLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxFQUFjLEVBQUUsQ0FBZ0IsRUFBRSxLQUFhO0lBQzlELE1BQU0sS0FBSyxHQUFHLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xDLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakIsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssRUFBRTtRQUN0QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDM0MsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN0QjtLQUNKO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCeXRlQnVmZmVyID0gcmVxdWlyZSgnYnl0ZWJ1ZmZlcicpO1xuXG5jbGFzcyBSYXdCdWZmZXIge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgYnVmZmVyOiBCeXRlQnVmZmVyO1xuXG4gICAgY29uc3RydWN0b3IoYjogQnVmZmVyIHwgbnVtYmVyKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYiA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZShiKS5MRSh0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyID0gQnl0ZUJ1ZmZlci53cmFwKGIpLkxFKHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLmNsZWFyKCk7XG4gICAgfVxuXG4gICAgc2V0T2Zmc2V0KG9mZnNldDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLm9mZnNldCA9IG9mZnNldDtcbiAgICB9XG5cbiAgICBnZXRPZmZzZXQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLm9mZnNldDtcbiAgICB9XG5cbiAgICBnZXRCdWZmZXIoKTogQnVmZmVyIHtcbiAgICAgICAgdGhpcy5idWZmZXIuZmxpcCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIudG9CdWZmZXIodHJ1ZSk7XG4gICAgfVxuXG4gICAgd3JpdGUoYnl0ZXM6IEJ1ZmZlcikge1xuICAgICAgICB0aGlzLmJ1ZmZlci5hcHBlbmQoYnl0ZXMpO1xuICAgIH1cblxuICAgIHdyaXRlQnl0ZShieXRlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVCeXRlKGJ5dGUpO1xuICAgIH1cblxuICAgIHJlYWRCeXRlcyhsZW5ndGg6IG51bWJlcik6IEJ1ZmZlciB7XG4gICAgICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5idWZmZXIucmVhZEJ5dGVzKGxlbmd0aCkuY29weSgpO1xuICAgICAgICByZXR1cm4gYnl0ZXMudG9CdWZmZXIoKTtcbiAgICB9XG5cbiAgICByZWFkSW50MTYoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlYWRJbnQxNigpO1xuICAgIH1cblxuICAgIHJlYWRJbnQzMigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZEludDMyKCk7XG4gICAgfVxuXG4gICAgcmVhZFVpbnQzMigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZFVpbnQzMigpO1xuICAgIH1cblxuICAgIHdyaXRlSW50MTYodmFsdWU6IG51bWJlciwgb2Zmc2V0PzogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLndyaXRlSW50MTYodmFsdWUsIG9mZnNldCk7XG4gICAgfVxuXG4gICAgLyoqIEBkZXByZWNhdGVkIHVzZSByZWFkSW50MzIoKSBpbnN0ZWFkICovXG4gICAgcmVhZEludCA9IHRoaXMucmVhZEludDMyO1xuXG4gICAgd3JpdGVJbnQzMih2YWx1ZTogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVJbnQzMih2YWx1ZSwgb2Zmc2V0KTtcbiAgICB9XG5cbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHdyaXRlSW50MzIoKSBpbnN0ZWFkICovXG4gICAgd3JpdGVJbnQgPSB0aGlzLndyaXRlSW50MzI7XG5cbiAgICByZWFkSW50NjQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlYWRJbnQ2NCgpLnRvTnVtYmVyKCk7XG4gICAgfVxuXG4gICAgcmVhZFVpbnQ2NCgpOiBiaWdpbnQge1xuICAgICAgICByZXR1cm4gQmlnSW50KHRoaXMuYnVmZmVyLnJlYWRVaW50NjQoKS50b1N0cmluZygxMCkpO1xuICAgIH1cblxuICAgIC8qKiBAZGVwcmVjYXRlZCB1c2UgcmVhZEludDY0KCkgaW5zdGVhZCAqL1xuICAgIHJlYWRMb25nID0gdGhpcy5yZWFkSW50NjQ7XG5cbiAgICB3cml0ZUludDY0KHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVJbnQ2NCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgd3JpdGVVaW50MzIodmFsdWU6IG51bWJlciwgb2Zmc2V0PzogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLndyaXRlVWludDY0KHZhbHVlLCBvZmZzZXQpO1xuICAgIH1cblxuICAgIHdyaXRlVWludDY0KHZhbHVlOiBiaWdpbnQsIG9mZnNldD86IG51bWJlcikge1xuICAgICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuYWxsb2MoOCk7XG4gICAgICAgIGJ1ZmZlci53cml0ZUJpZ1VpbnQ2NExFKHZhbHVlKTtcbiAgICAgICAgdGhpcy5idWZmZXIuYXBwZW5kKGJ1ZmZlciwgdW5kZWZpbmVkLCBvZmZzZXQpO1xuICAgIH1cblxuICAgIC8qKiBAZGVwcmVjYXRlZCB1c2Ugd3JpdGVJbnQ2NCgpIGluc3RlYWQgKi9cbiAgICB3cml0ZUxvbmcgPSB0aGlzLndyaXRlSW50NjQ7XG5cbiAgICByZWFkRmxvYXQzMigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZEZsb2F0MzIoKTtcbiAgICB9XG5cbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHJlYWRGbG9hdDMyKCkgaW5zdGVhZCAqL1xuICAgIHJlYWRGbG9hdCA9IHRoaXMucmVhZEZsb2F0MzI7XG5cbiAgICB3cml0ZUZsb2F0MzIodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLmJ1ZmZlci53cml0ZUZsb2F0MzIodmFsdWUpO1xuICAgIH1cblxuICAgIC8qKiBAZGVwcmVjYXRlZCB1c2Ugd3JpdGVGbG9hdDMyKCkgaW5zdGVhZCAqL1xuICAgIHdyaXRlRmxvYXQgPSB0aGlzLndyaXRlRmxvYXQzMjtcblxuICAgIHJlYWRGbG9hdDY0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZEZsb2F0NjQoKTtcbiAgICB9XG5cbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHJlYWRGbG9hdDY0KCkgaW5zdGVhZCAqL1xuICAgIHJlYWREb3VibGUgPSB0aGlzLnJlYWRGbG9hdDY0O1xuXG4gICAgd3JpdGVGbG9hdDY0KHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVGbG9hdDY0KHZhbHVlKTtcbiAgICB9XG5cbiAgICAvKiogQGRlcHJlY2F0ZWQgdXNlIHdyaXRlRmxvYXQ2NCgpIGluc3RlYWQgKi9cbiAgICB3cml0ZURvdWJsZSA9IHRoaXMud3JpdGVGbG9hdDY0O1xuXG4gICAgd3JpdGVTdHJpbmcodmFsdWU6IHN0cmluZywgZml4ZWRMZW5ndGg/OiBudW1iZXIpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgZml4ZWRMZW5ndGggfHwgdmFsdWUubGVuZ3RoKTtcbiAgICB9XG5cbiAgICByZWFkU3RyaW5nOCgpIHtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDgpO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nOCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHB1dFN0cmluZyh0aGlzLmJ1ZmZlciwgdmFsdWUsIDgpO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nMzAodmFsdWU6IHN0cmluZykge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCAzMCk7XG4gICAgfVxuXG4gICAgcmVhZFN0cmluZzMyKCkge1xuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgMzIpO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nMzIodmFsdWU6IHN0cmluZykge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCAzMik7XG4gICAgfVxuXG4gICAgcmVhZFN0cmluZzY0KCkge1xuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgNjQpO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nNjQodmFsdWU6IHN0cmluZykge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCA2NCk7XG4gICAgfVxuXG4gICAgcmVhZFN0cmluZzEyOCgpIHtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDEyOCk7XG4gICAgfVxuXG4gICAgd3JpdGVTdHJpbmcxMjgodmFsdWU6IHN0cmluZykge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCAxMjgpO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmcyNTYoKSB7XG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCAyNTYpO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nMjU2KHZhbHVlOiBzdHJpbmcgfCBudWxsKSB7XG4gICAgICAgIHB1dFN0cmluZyh0aGlzLmJ1ZmZlciwgdmFsdWUsIDI1Nik7XG4gICAgfVxuXG4gICAgcmVhZFN0cmluZzI2MCgpIHtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDI2MCk7XG4gICAgfVxuXG4gICAgd3JpdGVTdHJpbmcyNjAodmFsdWU6IHN0cmluZykge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCAyNjApO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmdWKCkge1xuICAgICAgICBsZXQgYnl0ZXNSZWFkID0gMDtcbiAgICAgICAgbGV0IHN0ckxlbiA9IDA7XG4gICAgICAgIGxldCBlbmRGb3VuZCA9IGZhbHNlO1xuICAgICAgICB3aGlsZSAodGhpcy5idWZmZXIub2Zmc2V0IDwgdGhpcy5idWZmZXIubGltaXQpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCeXRlID0gdGhpcy5idWZmZXIucmVhZEJ5dGUoKTtcbiAgICAgICAgICAgIGJ5dGVzUmVhZCsrO1xuICAgICAgICAgICAgaWYgKGVuZEZvdW5kICYmIGN1cnJlbnRCeXRlICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7IC8vIFJlYWNoZWQgYmVnaW5uaW5nIG9mIG5ldyB2YWx1ZVxuICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50Qnl0ZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGVuZEZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0ckxlbisrO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlc2V0IG9mZnNldCBzbyB3ZSBjYW4gcmVhZCB0aGUgc2FtZSBieXRlcyBsYXRlclxuICAgICAgICB0aGlzLmJ1ZmZlci5vZmZzZXQgLT0gYnl0ZXNSZWFkO1xuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgc3RyTGVuKTtcbiAgICB9XG5cbiAgICByZWFkU3RyaW5nKGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCBsZW5ndGgpO1xuICAgIH1cblxuICAgIHJlbWFpbmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlbWFpbmluZygpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbWFrZVN0cmluZyhiZjogQnl0ZUJ1ZmZlciwgZXhwZWN0ZWRMZW5ndGg6IG51bWJlcikge1xuICAgIGNvbnN0IGNvbnRlbnQgPSBiZi5yZWFkQ1N0cmluZyhiZi5vZmZzZXQpO1xuICAgIGJmLnNraXAoZXhwZWN0ZWRMZW5ndGgpO1xuICAgIHJldHVybiBjb250ZW50LnN0cmluZztcbn1cblxuZnVuY3Rpb24gcHV0U3RyaW5nKGJmOiBCeXRlQnVmZmVyLCBzOiBzdHJpbmcgfCBudWxsLCBmaXhlZDogbnVtYmVyKSB7XG4gICAgY29uc3QgdmFsdWUgPSBzID09PSBudWxsID8gJycgOiBzO1xuICAgIGNvbnN0IGJ5dGVzID0gQnVmZmVyLmZyb20odmFsdWUsICd1dGYtOCcpO1xuICAgIGJmLmFwcGVuZChieXRlcyk7XG4gICAgaWYgKGJ5dGVzLmxlbmd0aCA8IGZpeGVkKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZml4ZWQgLSBieXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYmYud3JpdGVCeXRlKDB4MDApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBSYXdCdWZmZXIgfTtcbiJdfQ==